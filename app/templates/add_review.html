{% extends "base.html" %} {% block content %}
<div class="max-w-2xl mx-auto">
  <div class="mb-12">
    <h1 class="text-3xl font-bold text-white tracking-tighter uppercase mb-2">
      Новая запись
    </h1>
    <div class="h-1 w-12 bg-white"></div>
  </div>

  <div class="mb-10 bg-zinc-950 border border-zinc-800 p-6">
    <label
      class="block text-[10px] uppercase tracking-[0.2em] text-zinc-500 mb-3"
      >Умный поиск</label
    >
    <div class="flex space-x-2">
      <input
        type="text"
        id="search_input"
        placeholder="НАЗВАНИЕ КНИГИ..."
        class="flex-grow bg-black border border-zinc-800 p-3 text-xs text-white focus:border-zinc-500 outline-none tracking-widest uppercase"
      />
      <button
        type="button"
        onclick="searchBook()"
        id="search_btn"
        class="bg-white text-black px-6 py-3 text-[10px] font-black uppercase tracking-widest hover:bg-zinc-200 transition"
      >
        Найти
      </button>
    </div>
  </div>

  <form action="/add" method="post" class="space-y-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <div>
        <label
          class="block text-[10px] uppercase tracking-[0.2em] text-zinc-500 mb-2"
          >Название</label
        >
        <input
          type="text"
          name="book_title"
          required
          class="w-full bg-black border-b border-zinc-800 p-2 text-white outline-none focus:border-white transition text-sm"
        />
      </div>
      <div>
        <label
          class="block text-[10px] uppercase tracking-[0.2em] text-zinc-500 mb-2"
          >Автор</label
        >
        <input
          type="text"
          name="author"
          required
          class="w-full bg-black border-b border-zinc-800 p-2 text-white outline-none focus:border-white transition text-sm"
        />
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <div>
        <label
          class="block text-[10px] uppercase tracking-[0.2em] text-zinc-500 mb-2"
          >Оценка (1-10)</label
        >
        <input
          type="number"
          name="rating"
          min="1"
          max="10"
          required
          class="w-full bg-black border-b border-zinc-800 p-2 text-white outline-none focus:border-white transition text-sm"
        />
      </div>
      <div>
        <label
          class="block text-[10px] uppercase tracking-[0.2em] text-zinc-500 mb-2"
          >Статус</label
        >
        <select
          name="status"
          class="w-full bg-black border-b border-zinc-800 p-2 text-zinc-400 text-[10px] uppercase tracking-widest outline-none focus:border-white"
        >
          <option value="Прочитано">Прочитано</option>
          <option value="Читаю сейчас">Читаю сейчас</option>
          <option value="В планах">В планах</option>
        </select>
      </div>
    </div>

    <input type="hidden" name="cover_url" />
    <textarea name="description" class="hidden"></textarea>

    <div>
      <label
        class="block text-[10px] uppercase tracking-[0.2em] text-zinc-500 mb-2"
        >Текст рецензии</label
      >
      <textarea
        name="text"
        rows="8"
        required
        class="w-full bg-zinc-950 border border-zinc-800 p-4 text-white outline-none focus:border-zinc-600 transition text-sm leading-relaxed"
      ></textarea>
    </div>

    <button
      type="submit"
      class="w-full bg-white text-black py-4 text-[10px] font-black uppercase tracking-[0.3em] hover:bg-zinc-200 transition"
    >
      Опубликовать
    </button>
  </form>
</div>

<script>
  async function searchBook() {
    const input = document.getElementById("search_input");
    const btn = document.getElementById("search_btn");
    if (!input.value) return;
    btn.innerText = "ПОИСК...";
    try {
      const resp = await fetch(
        `/search?title=${encodeURIComponent(input.value)}`,
      );
      const data = await resp.json();
      if (data.title) {
        document.getElementsByName("book_title")[0].value = data.title;
        document.getElementsByName("author")[0].value = data.author;
        document.getElementsByName("cover_url")[0].value = data.cover_url;
        document.getElementsByName("description")[0].value = data.description;
      }
    } finally {
      btn.innerText = "НАЙТИ";
    }
  }
</script>
{% endblock %}
